<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat with <%= otherUser.username %></title>
</head>
<body>
    <header>
        <h1>Chat with <%= otherUser.username %></h1>
    </header>
    <main>
        <div id="chat-window">
            <div id="messages"></div>
        </div>
        <input id="message-input" type="text" placeholder="Type a message...">
        <button id="send-button">Send</button>
    </main>
    <script src="/socket.io/socket.io.js"></script>

<script>
  const socket = io();
  const roomId = '<%= [user.id, otherUser.id].sort().join("_") %>';
  
  socket.emit('joinRoom', { roomId });

  socket.on('previousMessages', (messages) => {
    const messagesDiv = document.getElementById('messages');
    messages.forEach(msg => {
      const messageElement = document.createElement('p');
      messageElement.textContent = `${msg.sender_id}: ${msg.message}`;
      messagesDiv.appendChild(messageElement);
    });
  });

  socket.on('chatMessage', (data) => {
    const messagesDiv = document.getElementById('messages');
    const messageElement = document.createElement('p');
    messageElement.textContent = `${data.senderId}: ${data.message}`;
    messagesDiv.appendChild(messageElement);
  });
  document.getElementById('send-button').addEventListener('click', () => {
    const input = document.getElementById('message-input');
    const message = input.value.trim();
    
    if (message) {
      socket.emit('chatMessage', {
        roomId,
        message,
        senderId: '<%= user.id %>'
      });
      input.value = '';
    }
  });
</script>
</body>
</html>